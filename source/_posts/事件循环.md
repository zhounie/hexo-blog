---
title: 事件循环
date: 2020-04-01 11:29:10
tags:
---
### 宏任务与微任务

#### 宏任务
创建主文档对象，解析HTML，执行全局JS代码以及事件（页面加载、输入、网络事件和定时器事件）。宏任务代表一个个离散的独立工作单元。允许完任务后，浏览器可以继续其他调度，如重新渲染页面的UI或执行垃圾回收。

#### 微任务
微任务包括promise回调函数，DOM变化等。
微任务需要尽可能快的通过异步方式执行，同时不能产生全新的微任务。

#### 事件循环两个基本原则：
一次处理一个任务；
一个任务开始后直到运行完成，不会被其他任务中断；





1. 为什么添加任务到任务队列必须在事件循环外？
> 若添加任务到任务队列的过程是事件循环的一部分，那么当JS代码执行时发生的事件都将被忽略。
2. 为什么不能保证定时器的回调？
> 因为定时器会被添加进宏任务，那么当该任务前有其他任务时，该任务只能等待其他任务执行后才能执行该任务。
3. 为什么每一次事件循环的迭代不应超过16ms？
> 因为渲染是在事件循环结束时执行，每个迭代如果超过16ms，那么浏览器达不到60帧的渲染次数，就会显得卡顿。
